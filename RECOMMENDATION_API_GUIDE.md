# π― ν™”μ¥ν’ κ°μΈν™” μ¶”μ² API κ°€μ΄λ“

> μ‚¬μ©μμ ν”Όλ¶€ νƒ€μ…, μλ£ μ΅°κ±΄, μ„ νΈλ„λ¥Ό λ¶„μ„ν•΄ μ•μ „ν•κ³  λ§μ¶¤ν• ν™”μ¥ν’μ„ μ¶”μ²ν•λ” APIμ…λ‹λ‹¤.

## π“‹ λ©μ°¨
- [λΉ λ¥Έ μ‹μ‘](#λΉ λ¥Έ-μ‹μ‘)
- [μ”μ²­ νλΌλ―Έν„°](#μ”μ²­-νλΌλ―Έν„°)
- [μ¶”μ² μ²λ¦¬ νλ¦„](#μ¶”μ²-μ²λ¦¬-νλ¦„)
- [μ‘λ‹µ ν•μ‹](#μ‘λ‹µ-ν•μ‹)
- [μ‹¤μ  μ‚¬μ© μμ‹](#μ‹¤μ -μ‚¬μ©-μμ‹)

---

## π€ λΉ λ¥Έ μ‹μ‘

### κΈ°λ³Έ μ”μ²­
```bash
POST /api/v1/recommendations
Content-Type: application/json

{
  "intent_tags": ["moisturizing"],
  "top_n": 5
}
```

### μ‘λ‹µ
```json
{
  "recommendations": [
    {
      "rank": 1,
      "product_name": "μ–΄λ¦° μƒμ‹Ή μλ¶„ λ°Έλ°μ‹± λ΅μ…",
      "brand_name": "μμ΄μ¤ν‚¨",
      "category": "λ΅μ…/μ—λ©€μ Ό",
      "final_score": 68.0,
      "intent_match_score": 100.0,
      "reasons": ["moisturizingμ— λ§¤μ° μ ν•©ν• μ ν’μ…λ‹λ‹¤"]
    }
  ]
}
```

---

## π“ μ”μ²­ νλΌλ―Έν„°

### ν•„μ νλΌλ―Έν„°

| νλΌλ―Έν„° | νƒ€μ… | μ„¤λ… | μμ‹ |
|---------|------|------|------|
| `intent_tags` | `string[]` | μ›ν•λ” ν¨κ³Ό/κΈ°λ¥ | `["moisturizing", "anti_aging"]` |

### μ„ νƒ νλΌλ―Έν„°

#### π‘¤ μ‚¬μ©μ ν”„λ΅ν•„
```json
{
  "user_profile": {
    "age_group": "30s",           // "10s", "20s", "30s", "40s", "50s", "60s+"
    "gender": "female",           // "male", "female", "other"
    "skin_type": "dry",           // "dry", "oily", "combination", "sensitive", "normal"
    "skin_concerns": ["dryness", "wrinkles"],
    "allergies": ["fragrance", "alcohol"]
  }
}
```

#### π’ μλ£ μ •λ³΄
```json
{
  "med_profile": {
    "codes": ["B01AA03"],         // μμ•½ν’ ATC μ½”λ“
    "preg_lact": false            // μ„μ‹ /μμ  μ—¬λ¶€
  }
}
```

#### π• μ‚¬μ© λ§¥λ½
```json
{
  "use_context": {
    "leave_on": true,             // ν”Όλ¶€μ— λ‚¨κ²¨λ‘λ” μ ν’ μ—¬λ¶€
    "day_use": true,              // μ£Όκ°„ μ‚¬μ© μ—¬λ¶€
    "face": true,                 // μ–Όκµ΄ μ‚¬μ© μ—¬λ¶€
    "large_area_hint": false      // λ„“μ€ λ¶€μ„ μ‚¬μ© μ—¬λ¶€
  }
}
```

#### π›οΈ μ ν’ ν•„ν„°
```json
{
  "categories": ["λ΅μ…", "ν¬λ¦Ό"],
  "brands": ["λΌλ΅μν¬μ ", "μ„ΈλΌλ² "],
  "price_range": {"min": 10000, "max": 50000},
  "exclude_ingredients": ["retinol", "alcohol"],
  "top_n": 10
}
```

### π·οΈ μ§€μ›ν•λ” Intent Tags

| μΉ΄ν…κ³ λ¦¬ | νƒκ·Έ | μ„¤λ… |
|---------|------|------|
| **λ³΄μµ** | `moisturizing` | μλ¶„ κ³µκΈ‰ |
| | `hydrating` | μλ¶„ λ³΄μ¶© |
| **μ•ν‹°μ—μ΄μ§•** | `anti_aging` | λ…Έν™” λ°©μ§€ |
| | `wrinkle_care` | μ£Όλ¦„ μΌ€μ–΄ |
| **μ—¬λ“λ¦„** | `acne_care` | μ—¬λ“λ¦„ μΌ€μ–΄ |
| | `oil_control` | ν”Όμ§€ μ΅°μ  |
| **μ§„μ •** | `soothing` | μ§„μ • ν¨κ³Ό |
| | `gentle` | μν• μΌ€μ–΄ |
| **λ―Έλ°±** | `brightening` | λΈλΌμ΄νΈλ‹ |
| | `whitening` | λ―Έλ°± |

---

## β™οΈ μ¶”μ² μ²λ¦¬ νλ¦„

### 1λ‹¨κ³„: μ”μ²­ λ¶„μ„ π“
```
μ‚¬μ©μ μ”μ²­ β†’ μλ„ λ¶„μ„ β†’ μ•μ „μ„± ν”„λ΅ν•„ μƒμ„±
```
- Intent tagsλ¥Ό ν™”μ¥ν’ μ„±λ¶„/ν¨κ³Όμ™€ λ§¤μΉ­
- μμ•½ν’ μ½”λ“λ¥Ό μ•μ „μ„± λ£°κ³Ό μ—°κ²°
- μ‚¬μ© λ§¥λ½μ„ μ ν’ ν•„ν„°λ§ μ΅°κ±΄μΌλ΅ λ³€ν™

### 2λ‹¨κ³„: ν›„λ³΄ μ ν’ μ΅°ν π”
```
λ°μ΄ν„°λ² μ΄μ¤ β†’ μΉ΄ν…κ³ λ¦¬ ν•„ν„°λ§ β†’ λΈλλ“ ν•„ν„°λ§ β†’ κ°€κ²© ν•„ν„°λ§
```
- PostgreSQLμ—μ„ 326κ° μ ν’ μ¤‘ μ΅°κ±΄μ— λ§λ” ν›„λ³΄ μ„ λ³„
- μΉ΄ν…κ³ λ¦¬, λΈλλ“, κ°€κ²© λ²”μ„λ΅ 1μ°¨ ν•„ν„°λ§
- ν‰κ·  50-100κ° ν›„λ³΄ μ ν’ μ„ μ •

### 3λ‹¨κ³„: μ•μ „μ„± ν‰κ°€ π›΅οΈ
```
ν›„λ³΄ μ ν’ β†’ μ„±λ¶„ λ¶„μ„ β†’ μμ•½ν’ μƒνΈμ‘μ© κ²€μ‚¬ β†’ μ•μ „ μ ν’ μ„ λ³„
```

#### λ°°μ  λ£° μ μ©
- **μ™€νλ¦° λ³µμ©μ**: μ‚΄λ¦¬μ‹¤λ μ΄νΈ κ³„μ—΄ μ„±λ¶„ λ°°μ 
- **μ„μ‹ /μμ **: λ ν‹°λ†€, AHA λ“± μ„ν— μ„±λ¶„ λ°°μ   
- **κ΄‘κ³Όλ―Όμ„± μ•½λ¬Ό**: μ£Όκ°„ μ‚¬μ© μ‹ κ΄‘λ…μ„± μ„±λ¶„ λ°°μ 
- **μ¤ν…λ΅μ΄λ“ λ³µμ©**: μκ·Ήμ„± μ„±λ¶„ κ°μ  μ²λ¦¬

#### μ‹¤μ  μ²λ¦¬ μμ‹
```python
# μ™€νλ¦° λ³µμ©μμ κ²½μ°
if "B01AA03" in user_medications:
    exclude_ingredients.extend(["salicylic_acid", "wintergreen"])
    
# μ„μ‹  μ¤‘μΈ κ²½μ°  
if user_profile.preg_lact:
    exclude_ingredients.extend(["retinol", "tretinoin", "hydroquinone"])
```

### 4λ‹¨κ³„: μ μ κ³„μ‚° π―
```
μ•μ „ μ ν’ β†’ μλ„ λ§¤μΉ­ μ μ β†’ κ°μΈν™” μ μ β†’ μµμΆ… μ μ
```

#### μ μ κµ¬μ„±
- **κΈ°λ³Έ μ μ**: 60μ  (λ¨λ“  μ ν’ λ™μΌ)
- **μλ„ λ§¤μΉ­**: 0-40μ  (intent_tagsμ™€ μ ν’ ν¨κ³Ό λ§¤μΉ­λ„)
- **κ°μΈν™” λ³΄λ„μ¤**: 0-20μ  (ν”Όλ¶€ νƒ€μ…, μ—°λ Ήλ€ μ ν•©μ„±)
- **μ•μ „μ„± κ°μ **: 0-30μ  (μμ•½ν’ μƒνΈμ‘μ© μ„ν—λ„)

#### κ³„μ‚° κ³µμ‹
```
μµμΆ… μ μ = κΈ°λ³Έ μ μ + μλ„ λ§¤μΉ­ μ μ + κ°μΈν™” λ³΄λ„μ¤ - μ•μ „μ„± κ°μ 
```

### 5λ‹¨κ³„: μμ„ κ²°μ • π“
```
μ μλ³„ μ •λ ¬ β†’ λ‹¤μ–‘μ„± ν™•λ³΄ β†’ μµμΆ… μ¶”μ² λ©λ΅
```
- μµμΆ… μ μ κΈ°μ¤€ λ‚΄λ¦Όμ°¨μ μ •λ ¬
- λ™μΌ λΈλλ“ μ—°μ† λ°©μ§€ (λ‹¤μ–‘μ„± ν™•λ³΄)
- μ”μ²­ν• κ°μλ§νΌ μƒμ„ μ ν’ μ„ λ³„

---

## π“¤ μ‘λ‹µ ν•μ‹

### μ„±κ³µ μ‘λ‹µ
```json
{
  "execution_summary": {
    "request_id": "uuid",
    "timestamp": "2024-01-01T00:00:00Z",
    "success": true,
    "execution_time_seconds": 0.238,
    "ruleset_version": "v2.0",
    "active_rules_count": 30
  },
  "pipeline_statistics": {
    "total_candidates": 100,
    "excluded_by_rules": 25,
    "penalized_products": 15,
    "final_recommendations": 10,
    "eligibility_rules_applied": 8,
    "scoring_rules_applied": 22,
    "total_time_ms": 238.5
  },
  "recommendations": [
    {
      "rank": 1,
      "product_id": "12345",
      "product_name": "μ–΄λ¦° μƒμ‹Ή μλ¶„ λ°Έλ°μ‹± λ΅μ…",
      "brand_name": "μμ΄μ¤ν‚¨",
      "category": "λ΅μ…/μ—λ©€μ Ό",
      "final_score": 68.0,
      "intent_match_score": 100.0,
      "reasons": [
        "moisturizingμ— λ§¤μ° μ ν•©ν• μ ν’μ…λ‹λ‹¤",
        "μ•μ „μ„± μ°λ ¤κ°€ μ—†μ–΄ μ•μ‹¬ν•κ³  μ‚¬μ©ν•  μ μμµλ‹λ‹¤"
      ],
      "warnings": [],
      "rule_hits": []
    }
  ]
}
```

### μ¤λ¥ μ‘λ‹µ
```json
{
  "error": "VALIDATION_ERROR",
  "message": "intent_tagsλ” ν•„μ νλΌλ―Έν„°μ…λ‹λ‹¤",
  "details": {
    "field": "intent_tags",
    "code": "MISSING_REQUIRED_FIELD"
  }
}
```

---

## π’΅ μ‹¤μ  μ‚¬μ© μμ‹

### μμ‹ 1: κ³ νμ•• μλ” 50λ€ κ±΄μ„±ν”Όλ¶€
```json
{
  "intent_tags": ["moisturizing", "anti_aging"],
  "user_profile": {
    "age_group": "50s",
    "skin_type": "dry",
    "skin_concerns": ["dryness", "wrinkles"]
  },
  "med_profile": {
    "codes": ["C09AA02"]  // ACE μ–µμ μ 
  },
  "categories": ["λ΅μ…", "ν¬λ¦Ό"],
  "top_n": 5
}
```

**μ²λ¦¬ κ³Όμ •:**
1. 50λ€ + κ±΄μ„±ν”Όλ¶€ β†’ λ³΄μµλ ¥ λ†’μ€ μ ν’ μ°μ„ μμ„
2. κ³ νμ•• μ•½λ¬Ό β†’ μƒνΈμ‘μ© μ„±λ¶„ λ°°μ  κ²€μ‚¬
3. μ•ν‹°μ—μ΄μ§• β†’ μ½λΌκ², ν©νƒ€μ΄λ“ μ„±λ¶„ κ°€μ 
4. μµμΆ… 5κ° μ ν’ μ¶”μ²

### μμ‹ 2: μ„μ‹  μ¤‘μΈ 20λ€ λ―Όκ°μ„±ν”Όλ¶€
```json
{
  "intent_tags": ["gentle", "soothing"],
  "user_profile": {
    "age_group": "20s",
    "skin_type": "sensitive",
    "allergies": ["fragrance"]
  },
  "med_profile": {
    "preg_lact": true
  },
  "exclude_ingredients": ["retinol", "salicylic_acid"],
  "top_n": 3
}
```

**μ²λ¦¬ κ³Όμ •:**
1. μ„μ‹  μ¤‘ β†’ λ ν‹°λ†€, AHA, BHA λ“± μ„ν— μ„±λ¶„ μ™„μ „ λ°°μ 
2. λ―Όκ°μ„±ν”Όλ¶€ β†’ μκ·Ή μ„±λ¶„ λ°°μ , μ§„μ • μ„±λ¶„ κ°€μ 
3. λ¬΄ν–¥λ£ β†’ ν–¥λ£ ν¬ν•¨ μ ν’ λ°°μ 
4. μ•μ „ν• 3κ° μ ν’λ§ μ—„μ„  μ¶”μ²

### μμ‹ 3: μ™€νλ¦° λ³µμ© 60λ€ λ‚¨μ„±
```json
{
  "intent_tags": ["oil_control", "pore_care"],
  "user_profile": {
    "age_group": "60s+",
    "gender": "male",
    "skin_type": "oily"
  },
  "med_profile": {
    "codes": ["B01AA03"]  // μ™€νλ¦°
  },
  "categories": ["ν† λ„", "ν΄λ μ €"],
  "top_n": 5
}
```

**μ²λ¦¬ κ³Όμ •:**
1. μ™€νλ¦° λ³µμ© β†’ μ‚΄λ¦¬μ‹¤λ μ΄νΈ κ³„μ—΄ μ™„μ „ λ°°μ 
2. μ§€μ„±ν”Όλ¶€ β†’ ν”Όμ§€ μ΅°μ  μ„±λ¶„ κ°€μ 
3. λ‚¨μ„± + 60λ€ β†’ κ°„λ‹¨ν• μΌ€μ–΄ λ£¨ν‹΄ μ ν’ μ°μ„ 
4. **κ²°κ³Ό: 0κ° μ¶”μ²** (μ•μ „μ„± μ°μ„ μΌλ΅ λ¨λ“  μ ν’ λ°°μ )

---

## β΅ μ„±λ¥ μ§€ν‘

| μ§€ν‘ | λ©ν‘ | μ‹¤μ  μ„±λ¥ |
|------|------|----------|
| **μ‘λ‹µ μ‹κ°„** | < 500ms | ν‰κ·  238ms |
| **μ²λ¦¬λ‰** | > 100 req/s | μΈ΅μ • ν•„μ” |
| **μ •ν™•λ„** | > 95% | μλ„ λ§¤μΉ­ 100% |
| **μ•μ „μ„±** | 100% | μμ•½ν’ μƒνΈμ‘μ© μ™„μ „ μ°¨λ‹¨ |

---

## π”’ μ•μ „μ„± λ³΄μ¥

### μμ•½ν’ μƒνΈμ‘μ© κ²€μ‚¬
- **μ™€νλ¦°**: μ‚΄λ¦¬μ‹¤λ μ΄νΈ κ³„μ—΄ λ°°μ 
- **ν•­νμ†νμ **: μ¶ν μ„ν— μ„±λ¶„ λ°°μ   
- **μ¤ν…λ΅μ΄λ“**: μκ·Ήμ„± μ„±λ¶„ κ°μ 
- **κ΄‘κ³Όλ―Όμ„± μ•½λ¬Ό**: κ΄‘λ…μ„± μ„±λ¶„ μ£Όκ°„ μ‚¬μ© λ°°μ 

### μ„μ‹ /μμ  μ•μ „μ„±
- **μ™„μ „ λ°°μ **: λ ν‹°λ†€, ν•μ΄λ“λ΅ν€΄λ…Ό, κ³ λ†λ„ AHA
- **μ£Όμ μ„±λ¶„**: BHA, μ—μ„Όμ… μ¤μΌ
- **μ•μ „ μ„±λ¶„**: νμ•λ£¨λ΅ μ‚°, μ„ΈλΌλ§μ΄λ“, λ‚μ΄μ•„μ‹ μ•„λ§μ΄λ“

---

## π› οΈ κ°λ°μ ν

### μµμ μ μ¶”μ²μ„ μ„ν• κ¶μ¥μ‚¬ν•­
1. **intent_tagsλ” 2-3κ° μ΄ν•**λ΅ κµ¬μ²΄μ μΌλ΅ μ„¤μ •
2. **μμ•½ν’ μ •λ³΄λ” μ •ν™•ν• ATC μ½”λ“** μ‚¬μ©
3. **ν”Όλ¶€ νƒ€μ…κ³Ό κ³ λ―Όμ‚¬ν•­**μ„ μƒμ„Έν μ…λ ¥
4. **κ°€κ²© λ²”μ„ μ„¤μ •**μΌλ΅ ν„μ‹¤μ μΈ μ¶”μ² ν™•λ³΄

### μΌλ°μ μΈ μ‹¤μ
- β intent_tagsλ¥Ό λ„λ¬΄ λ§μ΄ μ„¤μ • (5κ° μ΄μƒ)
- β μλ»λ μμ•½ν’ μ½”λ“ μ…λ ¥
- β μƒμ¶©λλ” μ΅°κ±΄ μ„¤μ • (μ: μ§€μ„±ν”Όλ¶€ + λ³΄μµ μ§‘μ¤‘)

### λ””λ²„κΉ… κ°€μ΄λ“
```json
// μ¶”μ² κ²°κ³Όκ°€ 0κ°μΈ κ²½μ° ν™•μΈμ‚¬ν•­
{
  "pipeline_statistics": {
    "total_candidates": 0,     // β†’ μΉ΄ν…κ³ λ¦¬/λΈλλ“ ν•„ν„° ν™•μΈ
    "excluded_by_rules": 100,  // β†’ μμ•½ν’ μƒνΈμ‘μ© ν™•μΈ
    "final_recommendations": 0
  }
}
```

---

